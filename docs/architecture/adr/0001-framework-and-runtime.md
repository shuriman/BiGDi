# ADR 0001 — Выбор фреймворка и рантайма для сервиса `api`

- **Дата**: 2025-11-07
- **Статус**: Утверждено
- **Контекст**: Нужен веб/HTTP слой c REST API, SSR, Socket.IO/SSE и строгой модульной организацией. Команда работает на TypeScript, требуется быстрая разработка и встроенная инверсия зависимостей.

## Решение
Использовать **NestJS** на Node.js LTS (v20/22) с TypeScript.

## Обоснование
- NestJS предоставляет DI, модули, interceptors, guards, что облегчает разделение доменных границ (Identity, Settings, Jobs и т.д.).
- Встроенная поддержка Swagger, pipes, валидации (`class-validator`) и guard'ов ускоряет реализацию API-first подхода.
- Поддержка SSR (через `@nestjs/platform-express` или Fastify + view engine) и Socket.IO без значительных трудозатрат.
- Широкая экосистема, документация и опыт команды.

## Рассмотренные альтернативы
| Вариант | Плюсы | Минусы |
|---------|-------|--------|
| Express + собственная архитектура | Лёгкий, гибкий | Потребует самодельного DI/валидации/слоёв; повышает стоимость поддержки. |
| Fastify + ts-rest | Быстрая производительность | Меньше готовых решений для SSR + сокеты; нужен дополнительный каркас для модулей. |
| AdonisJS | Полный фреймворк | Новый стек для команды, слабая интеграция с BullMQ. |

## Последствия
- Необходимо придерживаться NestJS best practices (модули, dependency injection).
- Требует настройки `@nestjs/config`, `@nestjs/terminus`, `@nestjs/swagger` в проекте.
- Совместим с выбранной ORM (Prisma) через DI адаптеры.
