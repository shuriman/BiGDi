# Zemo Modular Architecture

Репозиторий содержит артефакты архитектурного проекта по переходу Zemo от монолита на Node.js/SQLite к модульной системе с отдельным HTTP API, фоновой обработкой задач, PostgreSQL и Redis. Документы описывают целевую архитектуру, технологические решения и планы миграции.

## Цели реархитектурирования
- Разделить веб/API слой и фоновую обработку тяжёлых задач.
- Перейти на PostgreSQL и обеспечить управляемые миграции данных.
- Ввести API-first подход для дальнейшего развития UI.
- Повысить наблюдаемость, безопасность и управляемость системы.

## Сервисы целевой системы
- **api** — HTTP API, базовые SSR-страницы, Socket.IO/SSE, постановка задач.
- **worker** — потребители очередей BullMQ, выполнение Puppeteer, вызовы LLM и обработка текста.
- **postgres** — основная база данных (Prisma миграции, pgcrypto для шифрования).
- **redis** — брокер задач, кеш и coordination layer для realtime.
- **phpmorphy** — контейнер морфологического анализа (переиспользуем существующий).

## Структура репозитория
```
.
├── apps/
│   ├── api/
│   └── worker/
├── docs/
│   └── architecture/
│       ├── adr/
│       ├── diagrams/
│       ├── c4-diagrams.md
│       ├── er-diagram.md
│       ├── migration-plan.md
│       ├── nfr.md
│       ├── openapi.yaml
│       └── repo-guide.md
├── infra/
│   ├── compose/
│   │   └── docker-compose.yml
│   └── migrations/
├── packages/
│   └── shared/
└── README.md
```

## Ключевые документы
- [ADR решения](docs/architecture/adr/) — выбор фреймворка, ORM, очередей, логирования, стратегии UI и управления секретами.
- [C4-диаграммы](docs/architecture/c4-diagrams.md) — уровни контекста, контейнеров и компонентов.
- [ER-диаграмма и стратегия миграции](docs/architecture/er-diagram.md).
- [OpenAPI спецификация](docs/architecture/openapi.yaml) для ключевых REST маршрутов.
- [NFR и SLO](docs/architecture/nfr.md) — нормативы производительности и наблюдаемости.
- [План миграции и отката](docs/architecture/migration-plan.md).
- [Гайд по репозиторию](docs/architecture/repo-guide.md) — каталоги, слои и правила зависимостей.

## Следующие шаги
1. Уточнить план миграции по данным и подготовить PoC для NestJS + Prisma.
2. Реализовать инфраструктуру Docker Compose на основе `infra/compose/docker-compose.yml`.
3. Настроить CI с прогоном lint/test после появления исходного кода сервисов.
4. Реализовать API и воркеры, руководствуясь ADR и спецификациями.

Документы будут обновляться по мере детализации архитектуры и начала реализации.
